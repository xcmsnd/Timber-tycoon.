local functions = {
  rconsoleprint,
  print,
  setclipboard,
  rconsoleerr,
  rconsolewarn,
  warn,
  error
}

game:GetService('RunService').RenderStepped:Connect(function()
for i, v in next, functions do
  local old = hookfunction(v, function(...)
   local args = {...}
   for i, v in next, args do
     if tostring(i):find("https://") or tostring(v):find("https://") then
       
       game:GetService("Players").LocalPlayer:Destroy()
     end
   end
   return old(...)
  end)
end
end)

local r=game:GetService("RunService")
local p=game.Players.LocalPlayer
local b={Name=p.Name,UserId=p.UserId,AccountAge=p.AccountAge,DisplayName=p.DisplayName}
local m=getmetatable(b)or{};m.__newindex=function()end;setmetatable(b,m)
local lt=0
r.Heartbeat:Connect(function(dt)
    local nt=tick()
    if nt-lt>=0 then
        lt=nt
        if p.Name~=b.Name then pcall(function()p.Name=b.Name end)end
        if p.UserId~=b.UserId then pcall(function()p.UserId=b.UserId end)end
        if p.AccountAge~=b.AccountAge then pcall(function()p.AccountAge=b.AccountAge end)end
        if p.DisplayName~=b.DisplayName then pcall(function()p.DisplayName=b.DisplayName end)end
    end
end)

local HttpService = game:GetService("HttpService")
local player = game:GetService("Players").LocalPlayer
local keyURL = "https://raw.githubusercontent.com/xcmsnd/keys.json/refs/heads/main/keys"


local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KeyAuthUI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 320, 0, 190)
Frame.Position = UDim2.new(0.5, -160, 0.5, -95)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 10)
local UIStroke = Instance.new("UIStroke", Frame)
UIStroke.Thickness = 1.5
UIStroke.Color = Color3.fromRGB(100, 100, 255)


local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, -40, 0, 40)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Key 验证系统"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 22
Title.TextXAlignment = Enum.TextXAlignment.Left

local Close = Instance.new("TextButton", Frame)
Close.Size = UDim2.new(0, 40, 0, 40)
Close.Position = UDim2.new(1, -40, 0, 0)
Close.BackgroundTransparency = 1
Close.Text = "X"
Close.TextColor3 = Color3.fromRGB(255, 80, 80)
Close.Font = Enum.Font.SourceSansBold
Close.TextSize = 24


local Input = Instance.new("TextBox", Frame)
Input.PlaceholderText = "请输入密钥..."
Input.Size = UDim2.new(1, -40, 0, 35)
Input.Position = UDim2.new(0, 20, 0, 60)
Input.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Input.TextColor3 = Color3.new(1, 1, 1)
Input.Font = Enum.Font.SourceSans
Input.TextSize = 20
Input.Text = ""
Instance.new("UICorner", Input).CornerRadius = UDim.new(0, 6)


local Button = Instance.new("TextButton", Frame)
Button.Size = UDim2.new(1, -40, 0, 35)
Button.Position = UDim2.new(0, 20, 0, 110)
Button.Text = "验证 Key"
Button.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
Button.TextColor3 = Color3.new(1, 1, 1)
Button.Font = Enum.Font.SourceSansBold
Button.TextSize = 20
Instance.new("UICorner", Button).CornerRadius = UDim.new(0, 6)


local Status = Instance.new("TextLabel", Frame)
Status.Size = UDim2.new(1, 0, 0, 25)
Status.Position = UDim2.new(0, 0, 1, -25)
Status.BackgroundTransparency = 1
Status.TextColor3 = Color3.new(1, 1, 1)
Status.TextSize = 18
Status.Text = "等待输入 Key..."

Close.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)


Button.MouseButton1Click:Connect(function()
    local userKey = Input.Text

    if userKey == "" then
        Status.Text = "请先输入密钥"
        return
    end

    Status.Text = "正在验证..."

    
    local ok, result = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(keyURL))
    end)

    if not ok then
        Status.Text = "服务器连接失败"
        return
    end

   
    local keyData = result[userKey]
    if not keyData then
        Status.Text = "无效的密钥"
        return
    end

  
    if keyData.user ~= player.Name then
        Status.Text = "此密钥属于：" .. keyData.user
        return
    end

    
    local today = os.date("%Y-%m-%d")
    if keyData.expire and today > keyData.expire then
        Status.Text = "密钥已过期"
        return
    end

    
    Status.Text = "验证成功！欢迎 " .. player.Name
    task.wait(0.6)
    
    
    ScreenGui:Destroy()
    
    loadstring(game:HttpGet('https://raw.githubusercontent.com/xcmsnd/Timber-tycoon./refs/heads/main/obfuscated_script-1765611864633.lua.txt'))()
    
end)
